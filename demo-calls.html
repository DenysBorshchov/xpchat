<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPchat Pro - Демо WebRTC Звонков</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .demo-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .demo-header h1 {
            color: var(--accent-color);
            margin-bottom: 10px;
        }
        
        .demo-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }
        
        .demo-section h2 {
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .demo-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .demo-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .demo-btn:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }
        
        .demo-btn.danger {
            background: var(--danger-color);
        }
        
        .demo-btn.danger:hover {
            background: #d32f2f;
        }
        
        .demo-btn.success {
            background: var(--success-color);
        }
        
        .demo-btn.success:hover {
            background: #2e7d32;
        }
        
        .demo-info {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .demo-info h3 {
            color: var(--text-primary);
            margin-bottom: 15px;
        }
        
        .demo-info ul {
            color: var(--text-secondary);
            line-height: 1.6;
        }
        
        .demo-info li {
            margin-bottom: 8px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-online {
            background: var(--success-color);
        }
        
        .status-offline {
            background: var(--danger-color);
        }
        
        .status-connecting {
            background: var(--warning-color);
        }
        
        .test-users {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-user {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .test-user-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            color: white;
            font-size: 1.5rem;
        }
        
        .test-user-name {
            color: var(--text-primary);
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .test-user-status {
            color: var(--text-secondary);
            margin-bottom: 15px;
            font-size: 0.9rem;
        }
        
        .test-user-actions {
            display: flex;
            gap: 8px;
            justify-content: center;
        }
        
        .test-user-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 8px 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }
        
        .test-user-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.05);
        }
        
        .test-user-btn.audio {
            background: var(--success-color);
        }
        
        .test-user-btn.video {
            background: var(--accent-color);
        }
        
        .test-user-btn.screen {
            background: var(--info-color);
        }
        
        .call-history {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .call-record {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .call-record-info {
            flex: 1;
        }
        
        .call-record-type {
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 5px;
        }
        
        .call-record-details {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        .call-record-time {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
        
        .permissions-status {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .permission-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background: var(--bg-primary);
            border-radius: 6px;
            border: 1px solid var(--border-color);
        }
        
        .permission-icon {
            font-size: 1.2rem;
        }
        
        .permission-granted {
            color: var(--success-color);
        }
        
        .permission-denied {
            color: var(--danger-color);
        }
        
        .permission-unknown {
            color: var(--warning-color);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .demo-controls {
                flex-direction: column;
            }
            
            .demo-btn {
                width: 100%;
                justify-content: center;
            }
            
            .permissions-status {
                flex-direction: column;
            }
            
            .test-users {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1><i class="fas fa-phone"></i> XPchat Pro - Демо WebRTC Звонков</h1>
            <p>Тестирование голосовых и видеозвонков через WebRTC</p>
        </div>

        <!-- Статус WebRTC -->
        <div class="demo-section">
            <h2><i class="fas fa-info-circle"></i> Статус WebRTC</h2>
            <div class="demo-info">
                <div class="permissions-status">
                    <div class="permission-item">
                        <i class="fas fa-microphone permission-icon permission-unknown" id="micStatus"></i>
                        <span>Микрофон</span>
                    </div>
                    <div class="permission-item">
                        <i class="fas fa-video permission-icon permission-unknown" id="cameraStatus"></i>
                        <span>Камера</span>
                    </div>
                    <div class="permission-item">
                        <i class="fas fa-desktop permission-icon permission-unknown" id="screenStatus"></i>
                        <span>Экран</span>
                    </div>
                </div>
                
                <div class="demo-controls">
                    <button class="demo-btn" id="checkPermissionsBtn">
                        <i class="fas fa-check"></i> Проверить разрешения
                    </button>
                    <button class="demo-btn" id="requestPermissionsBtn">
                        <i class="fas fa-key"></i> Запросить разрешения
                    </button>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="webrtcSupport">-</div>
                        <div class="stat-label">WebRTC поддержка</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="connectionStatus">-</div>
                        <div class="stat-label">Статус соединения</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeCalls">0</div>
                        <div class="stat-label">Активные звонки</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Тестовые пользователи -->
        <div class="demo-section">
            <h2><i class="fas fa-users"></i> Тестовые пользователи</h2>
            <div class="demo-info">
                <p>Выберите пользователя для тестирования звонков:</p>
                
                <div class="test-users">
                    <div class="test-user">
                        <div class="test-user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="test-user-name">Анна Петрова</div>
                        <div class="test-user-status">
                            <span class="status-indicator status-online"></span>
                            Онлайн
                        </div>
                        <div class="test-user-actions">
                            <button class="test-user-btn audio" data-user="anna" data-type="audio">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button class="test-user-btn video" data-user="anna" data-type="video">
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="test-user-btn screen" data-user="anna" data-type="screen">
                                <i class="fas fa-desktop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="test-user">
                        <div class="test-user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="test-user-name">Иван Сидоров</div>
                        <div class="test-user-status">
                            <span class="status-indicator status-online"></span>
                            Онлайн
                        </div>
                        <div class="test-user-actions">
                            <button class="test-user-btn audio" data-user="ivan" data-type="audio">
                                <i class="fas fa-phone"></i>
                            </button>
                            <button class="test-user-btn video" data-user="ivan" data-type="video">
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="test-user-btn screen" data-user="ivan" data-type="screen">
                                <i class="fas fa-desktop"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="test-user">
                        <div class="test-user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="test-user-name">Мария Козлова</div>
                        <div class="test-user-status">
                            <span class="status-indicator status-offline"></span>
                            Офлайн
                        </div>
                        <div class="test-user-actions">
                            <button class="test-user-btn audio" data-user="maria" data-type="audio" disabled>
                                <i class="fas fa-phone"></i>
                            </button>
                            <button class="test-user-btn video" data-user="maria" data-type="video" disabled>
                                <i class="fas fa-video"></i>
                            </button>
                            <button class="test-user-btn screen" data-user="maria" data-type="screen" disabled>
                                <i class="fas fa-desktop"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Управление звонками -->
        <div class="demo-section">
            <h2><i class="fas fa-phone-alt"></i> Управление звонками</h2>
            <div class="demo-info">
                <div class="demo-controls">
                    <button class="demo-btn" id="startCallBtn">
                        <i class="fas fa-phone"></i> Начать звонок
                    </button>
                    <button class="demo-btn success" id="acceptCallBtn">
                        <i class="fas fa-phone"></i> Принять звонок
                    </button>
                    <button class="demo-btn danger" id="endCallBtn">
                        <i class="fas fa-phone-slash"></i> Завершить звонок
                    </button>
                </div>
                
                <div class="demo-controls">
                    <button class="demo-btn" id="toggleMuteBtn">
                        <i class="fas fa-microphone"></i> Отключить микрофон
                    </button>
                    <button class="demo-btn" id="toggleVideoBtn">
                        <i class="fas fa-video"></i> Отключить видео
                    </button>
                    <button class="demo-btn" id="toggleScreenBtn">
                        <i class="fas fa-desktop"></i> Демонстрация экрана
                    </button>
                </div>
                
                <div class="demo-controls">
                    <button class="demo-btn" id="recordCallBtn">
                        <i class="fas fa-record-vinyl"></i> Записать звонок
                    </button>
                    <button class="demo-btn" id="addParticipantBtn">
                        <i class="fas fa-user-plus"></i> Добавить участника
                    </button>
                    <button class="demo-btn" id="chatBtn">
                        <i class="fas fa-comment"></i> Чат во время звонка
                    </button>
                </div>
            </div>
        </div>

        <!-- История звонков -->
        <div class="demo-section">
            <h2><i class="fas fa-history"></i> История звонков</h2>
            <div class="demo-info">
                <div class="demo-controls">
                    <button class="demo-btn" id="clearHistoryBtn">
                        <i class="fas fa-trash"></i> Очистить историю
                    </button>
                    <button class="demo-btn" id="exportHistoryBtn">
                        <i class="fas fa-download"></i> Экспорт
                    </button>
                </div>
                
                <div class="call-history" id="callHistory">
                    <p style="text-align: center; color: var(--text-secondary);">
                        История звонков пуста
                    </p>
                </div>
            </div>
        </div>

        <!-- Тестирование функций -->
        <div class="demo-section">
            <h2><i class="fas fa-vial"></i> Тестирование функций</h2>
            <div class="demo-info">
                <div class="demo-controls">
                    <button class="demo-btn" id="testAudioBtn">
                        <i class="fas fa-volume-up"></i> Тест аудио
                    </button>
                    <button class="demo-btn" id="testVideoBtn">
                        <i class="fas fa-video"></i> Тест видео
                    </button>
                    <button class="demo-btn" id="testScreenBtn">
                        <i class="fas fa-desktop"></i> Тест экрана
                    </button>
                </div>
                
                <div class="demo-controls">
                    <button class="demo-btn" id="simulateCallBtn">
                        <i class="fas fa-phone"></i> Симуляция входящего звонка
                    </button>
                    <button class="demo-btn" id="testConnectionBtn">
                        <i class="fas fa-network-wired"></i> Тест соединения
                    </button>
                    <button class="demo-btn" id="performanceTestBtn">
                        <i class="fas fa-tachometer-alt"></i> Тест производительности
                    </button>
                </div>
            </div>
        </div>

        <!-- Информация -->
        <div class="demo-section">
            <h2><i class="fas fa-book"></i> Информация</h2>
            <div class="demo-info">
                <h3>Как использовать демо:</h3>
                <ul>
                    <li><strong>1.</strong> Проверьте разрешения на микрофон и камеру</li>
                    <li><strong>2.</strong> Выберите тестового пользователя</li>
                    <li><strong>3.</strong> Нажмите кнопку нужного типа звонка</li>
                    <li><strong>4.</strong> Используйте элементы управления во время звонка</li>
                    <li><strong>5.</strong> Просматривайте историю и статистику</li>
                </ul>
                
                <h3>Поддерживаемые браузеры:</h3>
                <ul>
                    <li>✅ Chrome 66+ (рекомендуется)</li>
                    <li>✅ Firefox 60+</li>
                    <li>✅ Safari 11+</li>
                    <li>✅ Edge 79+</li>
                </ul>
                
                <h3>Требования:</h3>
                <ul>
                    <li>HTTPS соединение (для production)</li>
                    <li>Микрофон и/или камера</li>
                    <li>Стабильное интернет-соединение</li>
                    <li>Поддержка WebRTC в браузере</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Скрипты -->
    <script src="webrtc-calls.js"></script>
    <script>
        // Демо функциональность
        class WebRTCDemo {
            constructor() {
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.checkWebRTCSupport();
                this.updatePermissionsStatus();
                this.loadCallHistory();
            }

            setupEventListeners() {
                // Кнопки разрешений
                document.getElementById('checkPermissionsBtn').addEventListener('click', () => {
                    this.checkPermissions();
                });

                document.getElementById('requestPermissionsBtn').addEventListener('click', () => {
                    this.requestPermissions();
                });

                // Кнопки тестовых пользователей
                document.querySelectorAll('.test-user-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        if (!btn.disabled) {
                            const user = btn.dataset.user;
                            const type = btn.dataset.type;
                            this.initiateTestCall(user, type);
                        }
                    });
                });

                // Кнопки управления звонками
                document.getElementById('startCallBtn').addEventListener('click', () => {
                    this.startTestCall();
                });

                document.getElementById('acceptCallBtn').addEventListener('click', () => {
                    this.acceptTestCall();
                });

                document.getElementById('endCallBtn').addEventListener('click', () => {
                    this.endTestCall();
                });

                // Кнопки управления медиа
                document.getElementById('toggleMuteBtn').addEventListener('click', () => {
                    this.toggleMute();
                });

                document.getElementById('toggleVideoBtn').addEventListener('click', () => {
                    this.toggleVideo();
                });

                document.getElementById('toggleScreenBtn').addEventListener('click', () => {
                    this.toggleScreen();
                });

                // Дополнительные функции
                document.getElementById('recordCallBtn').addEventListener('click', () => {
                    this.toggleRecording();
                });

                document.getElementById('addParticipantBtn').addEventListener('click', () => {
                    this.addParticipant();
                });

                document.getElementById('chatBtn').addEventListener('click', () => {
                    this.toggleChat();
                });

                // История звонков
                document.getElementById('clearHistoryBtn').addEventListener('click', () => {
                    this.clearCallHistory();
                });

                document.getElementById('exportHistoryBtn').addEventListener('click', () => {
                    this.exportCallHistory();
                });

                // Тестирование
                document.getElementById('testAudioBtn').addEventListener('click', () => {
                    this.testAudio();
                });

                document.getElementById('testVideoBtn').addEventListener('click', () => {
                    this.testVideo();
                });

                document.getElementById('testScreenBtn').addEventListener('click', () => {
                    this.testScreen();
                });

                document.getElementById('simulateCallBtn').addEventListener('click', () => {
                    this.simulateIncomingCall();
                });

                document.getElementById('testConnectionBtn').addEventListener('click', () => {
                    this.testConnection();
                });

                document.getElementById('performanceTestBtn').addEventListener('click', () => {
                    this.testPerformance();
                });
            }

            checkWebRTCSupport() {
                const support = {
                    webrtc: !!window.RTCPeerConnection,
                    getUserMedia: !!navigator.mediaDevices?.getUserMedia,
                    getDisplayMedia: !!navigator.mediaDevices?.getDisplayMedia,
                    mediaRecorder: !!window.MediaRecorder
                };

                const webrtcSupport = document.getElementById('webrtcSupport');
                if (support.webrtc && support.getUserMedia) {
                    webrtcSupport.textContent = '✅';
                    webrtcSupport.style.color = 'var(--success-color)';
                } else {
                    webrtcSupport.textContent = '❌';
                    webrtcSupport.style.color = 'var(--danger-color)';
                }

                return support;
            }

            async updatePermissionsStatus() {
                try {
                    // Проверяем разрешения
                    const micPermission = await navigator.permissions.query({ name: 'microphone' });
                    const cameraPermission = await navigator.permissions.query({ name: 'camera' });

                    this.updatePermissionIcon('micStatus', micPermission.state);
                    this.updatePermissionIcon('cameraStatus', cameraPermission.state);
                    this.updatePermissionIcon('screenStatus', 'granted'); // Screen capture не имеет permissions API
                } catch (error) {
                    console.log('Не удалось проверить разрешения:', error);
                }
            }

            updatePermissionIcon(elementId, state) {
                const element = document.getElementById(elementId);
                const icon = element.querySelector('.permission-icon');
                
                element.classList.remove('permission-granted', 'permission-denied', 'permission-unknown');
                
                switch (state) {
                    case 'granted':
                        icon.classList.add('permission-granted');
                        icon.className = 'fas fa-check permission-icon permission-granted';
                        break;
                    case 'denied':
                        icon.classList.add('permission-denied');
                        icon.className = 'fas fa-times permission-icon permission-denied';
                        break;
                    default:
                        icon.classList.add('permission-unknown');
                        icon.className = 'fas fa-question permission-icon permission-unknown';
                }
            }

            async checkPermissions() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
                    stream.getTracks().forEach(track => track.stop());
                    
                    this.updatePermissionIcon('micStatus', 'granted');
                    this.updatePermissionIcon('cameraStatus', 'granted');
                    
                    this.showNotification('Разрешения проверены', 'Доступ к микрофону и камере подтвержден', 'success');
                } catch (error) {
                    this.showNotification('Ошибка разрешений', error.message, 'error');
                }
            }

            async requestPermissions() {
                try {
                    await this.checkPermissions();
                    this.showNotification('Разрешения запрошены', 'Проверьте настройки браузера', 'info');
                } catch (error) {
                    this.showNotification('Ошибка', 'Не удалось запросить разрешения', 'error');
                }
            }

            initiateTestCall(user, type) {
                if (!window.webrtcCalls) {
                    this.showNotification('Ошибка', 'Модуль WebRTC не загружен', 'error');
                    return;
                }

                this.showNotification('Инициация звонка', `Начинаем ${type} звонок с ${user}`, 'info');
                
                // В демо режиме просто показываем интерфейс звонка
                if (window.webrtcCalls.showCallInterface) {
                    window.webrtcCalls.showCallInterface();
                }
            }

            startTestCall() {
                this.showNotification('Тестовый звонок', 'Начинаем тестовый звонок', 'info');
            }

            acceptTestCall() {
                this.showNotification('Звонок принят', 'Тестовый звонок принят', 'success');
            }

            endTestCall() {
                this.showNotification('Звонок завершен', 'Тестовый звонок завершен', 'info');
            }

            toggleMute() {
                this.showNotification('Микрофон', 'Состояние микрофона изменено', 'info');
            }

            toggleVideo() {
                this.showNotification('Видео', 'Состояние видео изменено', 'info');
            }

            toggleScreen() {
                this.showNotification('Экран', 'Демонстрация экрана переключена', 'info');
            }

            toggleRecording() {
                this.showNotification('Запись', 'Запись звонка переключена', 'info');
            }

            addParticipant() {
                this.showNotification('Участник', 'Добавление нового участника', 'info');
            }

            toggleChat() {
                this.showNotification('Чат', 'Чат во время звонка переключен', 'info');
            }

            loadCallHistory() {
                const history = JSON.parse(localStorage.getItem('call_history') || '[]');
                this.displayCallHistory(history);
            }

            displayCallHistory(history) {
                const container = document.getElementById('callHistory');
                
                if (history.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">История звонков пуста</p>';
                    return;
                }

                container.innerHTML = history.map(call => `
                    <div class="call-record">
                        <div class="call-record-info">
                            <div class="call-record-type">${this.getCallTypeLabel(call.type)}</div>
                            <div class="call-record-details">${call.status} • ${call.duration || 0}с</div>
                        </div>
                        <div class="call-record-time">${new Date(call.timestamp).toLocaleString()}</div>
                    </div>
                `).join('');
            }

            getCallTypeLabel(type) {
                const labels = {
                    audio: 'Голосовой звонок',
                    video: 'Видеозвонок',
                    screen: 'Демонстрация экрана'
                };
                return labels[type] || type;
            }

            clearCallHistory() {
                localStorage.removeItem('call_history');
                this.loadCallHistory();
                this.showNotification('История очищена', 'История звонков очищена', 'success');
            }

            exportCallHistory() {
                const history = JSON.parse(localStorage.getItem('call_history') || '[]');
                const dataStr = JSON.stringify(history, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `call_history_${Date.now()}.json`;
                link.click();
                
                this.showNotification('Экспорт', 'История звонков экспортирована', 'success');
            }

            async testAudio() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    this.showNotification('Тест аудио', 'Аудио работает корректно', 'success');
                    stream.getTracks().forEach(track => track.stop());
                } catch (error) {
                    this.showNotification('Ошибка аудио', error.message, 'error');
                }
            }

            async testVideo() {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    this.showNotification('Тест видео', 'Видео работает корректно', 'success');
                    stream.getTracks().forEach(track => track.stop());
                } catch (error) {
                    this.showNotification('Ошибка видео', error.message, 'error');
                }
            }

            async testScreen() {
                try {
                    const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                    this.showNotification('Тест экрана', 'Демонстрация экрана работает', 'success');
                    stream.getTracks().forEach(track => track.stop());
                } catch (error) {
                    this.showNotification('Ошибка экрана', error.message, 'error');
                }
            }

            simulateIncomingCall() {
                if (window.webrtcCalls && window.webrtcCalls.showIncomingCallNotification) {
                    window.webrtcCalls.showIncomingCallNotification('demo_user', 'video');
                    this.showNotification('Симуляция', 'Входящий звонок симулирован', 'info');
                } else {
                    this.showNotification('Ошибка', 'Функция симуляции недоступна', 'error');
                }
            }

            testConnection() {
                this.showNotification('Тест соединения', 'Проверка сетевого соединения...', 'info');
                
                // Простой тест соединения
                setTimeout(() => {
                    this.showNotification('Соединение', 'Сетевое соединение стабильно', 'success');
                }, 2000);
            }

            testPerformance() {
                this.showNotification('Тест производительности', 'Измерение производительности...', 'info');
                
                // Простой тест производительности
                const start = performance.now();
                setTimeout(() => {
                    const duration = performance.now() - start;
                    this.showNotification('Производительность', `Время отклика: ${duration.toFixed(2)}мс`, 'success');
                }, 1000);
            }

            showNotification(title, message, type = 'info') {
                // Простая система уведомлений для демо
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: var(--bg-secondary);
                    border: 1px solid var(--border-color);
                    border-radius: 8px;
                    padding: 15px 20px;
                    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
                    z-index: 10000;
                    max-width: 300px;
                    animation: slideInRight 0.3s ease;
                `;
                
                notification.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 5px; color: var(--text-primary);">${title}</div>
                    <div style="color: var(--text-secondary); font-size: 0.9rem;">${message}</div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 5000);
            }
        }

        // Инициализация демо при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            window.webrtcDemo = new WebRTCDemo();
        });
    </script>
</body>
</html>
